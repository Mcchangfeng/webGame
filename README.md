# webGame
## Introtuction
本项目使用ZINX框架，搭建了一套游戏后端服务器程序，实现了多人在线网游。服务程序采用三层框架设计，第一层为通道层，第二层为协议层，第三层为业务层。通道层继承ZINX框架的TCP类，负责建立TCP连接、通信等，实现与客户端的数据发送与接收。协议层负责将将通道层的数据，转化为自定义的用户数据，交给业务层处理；也可以完成将业务层的数据转化为字符串，交给通道层，进行发送。业务层负责处理业务数据，项目中设计了群发消息，同步移动数据等业务。

##游戏业务实现
###1.使用ZINX框架
三层架构设计，分为通道层、协议层、业务层。
通道层负责TCP数据的收发，将数据接收发送给协议层；接收协议层数据发送到游戏客户端。
协议层负责处理通道层的数据，将数据打包成自定义的游戏数据，传递给业务层；接收业务层的业务数据，转化成字符串传递给通道层
业务层负责处理业务，创建玩家、玩家位置信息同步、世界窗口聊天；根据协议层发来的游戏数据，其中有指令编号字段，对应了该进行什么操作。
###2.AOI算法
设置AOIworld类，矩形世界，划分网格，只有网格内部或者前后左右网格可见。需要实现获取周围玩家、添加玩家、玩家下线删除等功能。
###3.游戏同步策略
游戏服务器被调用，说明有一个玩家使用，创建其管道、协议以及用户层，创建用户过程就像周围玩家同步位置等信息；如果发生移动也会同步更新，客户端识别到移动，将移动数据发送给服务器，服务器将移动后的数据发送给周围玩家的客户端，客户端同步更新，即可看到变化；不同业务处理根据protobuf定义的事务类型来进行。
###4.时间轮定时器
执行定时任务
如定时关闭：如果服务器中只剩一个玩家，且马上也要退出时，那么倒计时五秒，关闭游戏服务端。
数据结构如下：
![image](https://github.com/user-attachments/assets/19f1463b-671a-479f-84cc-a24f76b1a9a8)

每到一个时间点，会去检查本刻度链表上的所有定时任务，看它们剩余的圈数是否为0，如果为0，加入到执行队列中，遍历完所有定时任务，开始执行定时任务。
###5.打包
使用静态编译+动态编译生成可执行文件，游戏服务使用到的ZINX库、redis库、protobuf库使用静态编译，基础c++库使用静态编译，控制程序大小。
Dockerfile创建docker镜像，利用基础ubuntu镜像，加上游戏可执行文件，游戏执行脚本，基本文本文件，设置自动获取端口以及设置执行点，完成镜像创建。
'''
FROM ubuntu
WORKDIR /root/
COPY game /root/
COPY game_boot.sh /root/
EXPOSE 8899
ENTRYPOINT ["./game_boot.sh"]
'''
##分布式部署
![image](https://github.com/user-attachments/assets/a2cb6858-fa99-435d-9775-a16f226ff90e)
